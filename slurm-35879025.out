/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/lightning_fabric/__init__.py:40: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_csv from `anndata` is deprecated. Import anndata.io.read_csv instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_text from `anndata` is deprecated. Import anndata.io.read_text instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_excel from `anndata` is deprecated. Import anndata.io.read_excel instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_mtx from `anndata` is deprecated. Import anndata.io.read_mtx instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_loom from `anndata` is deprecated. Import anndata.io.read_loom instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_hdf from `anndata` is deprecated. Import anndata.io.read_hdf instead.
  warnings.warn(msg, FutureWarning)
/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/anndata/utils.py:434: FutureWarning: Importing read_umi_tools from `anndata` is deprecated. Import anndata.io.read_umi_tools instead.
  warnings.warn(msg, FutureWarning)
[rank: 0] Seed set to 42
GPU available: True (cuda), used: True
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0]

  | Name       | Type             | Params
------------------------------------------------
0 | relu       | ReLU             | 0     
1 | odconv2d   | ODConv2d         | 3.8 K 
2 | caps_layer | EfficientCapsNet | 317 K 
3 | x_embed    | Embedding        | 4.1 K 
4 | y_embed    | Embedding        | 4.1 K 
5 | vit        | ViT              | 46.2 M
6 | gat        | MultiHeadGAT     | 15.7 M
7 | gene_head  | Sequential       | 5.0 M 
------------------------------------------------
67.3 M    Trainable params
0         Non-trainable params
67.3 M    Total params
269.070   Total estimated model params size (MB)
SLURM auto-requeueing enabled. Setting signal handlers.
Configuration:
  Mode: train_test
  Dataset: HEST1K
  Gene List: Hallmark
  GPUs: 1
  Num Workers: 4
  Strategy: None
  Epochs: 5
  Learning Rate: 1e-05
  Batch Size: 1
  Model Directory: model

==================================================
TRAINING PHASE
==================================================
Looking for HEST1K data in: ../../data/HERST_preprocess/Hallmark_genes/train
Found 424 samples.
Looking for HEST1K data in: ../../data/HERST_preprocess/Hallmark_genes/val
Found 120 samples.
Looking for HEST1K data in: ../../data/HERST_preprocess/Hallmark_genes/test
Found 61 samples.
Sanity Checking: |          | 0/? [00:00<?, ?it/s]Sanity Checking:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:   0%|          | 0/2 [00:00<?, ?it/s]Sanity Checking DataLoader 0:  50%|█████     | 1/2 [00:00<00:00,  1.31it/s]Sanity Checking DataLoader 0: 100%|██████████| 2/2 [00:00<00:00,  2.34it/s]                                                                           Training: |          | 0/? [00:00<?, ?it/s]Training:   0%|          | 0/424 [00:00<?, ?it/s]Epoch 0:   0%|          | 0/424 [00:00<?, ?it/s] Epoch 0:   0%|          | 1/424 [00:16<1:53:43,  0.06it/s]Epoch 0:   0%|          | 1/424 [00:16<1:53:43,  0.06it/s, v_num=2, train_loss=0.930]Epoch 0:   0%|          | 2/424 [00:16<56:58,  0.12it/s, v_num=2, train_loss=0.930]  Epoch 0:   0%|          | 2/424 [00:16<56:58,  0.12it/s, v_num=2, train_loss=0.827]Epoch 0:   1%|          | 3/424 [00:16<38:12,  0.18it/s, v_num=2, train_loss=0.827]Epoch 0:   1%|          | 3/424 [00:16<38:21,  0.18it/s, v_num=2, train_loss=0.784]Epoch 0:   1%|          | 4/424 [00:16<29:11,  0.24it/s, v_num=2, train_loss=0.784]Epoch 0:   1%|          | 4/424 [00:16<29:35,  0.24it/s, v_num=2, train_loss=0.764]Epoch 0:   1%|          | 5/424 [00:17<23:50,  0.29it/s, v_num=2, train_loss=0.764]Epoch 0:   1%|          | 5/424 [00:17<23:51,  0.29it/s, v_num=2, train_loss=0.809]Epoch 0:   1%|▏         | 6/424 [00:17<19:55,  0.35it/s, v_num=2, train_loss=0.809]Epoch 0:   1%|▏         | 6/424 [00:17<19:56,  0.35it/s, v_num=2, train_loss=0.627]Epoch 0:   2%|▏         | 7/424 [00:17<17:10,  0.40it/s, v_num=2, train_loss=0.627]Epoch 0:   2%|▏         | 7/424 [00:17<17:12,  0.40it/s, v_num=2, train_loss=1.070]Epoch 0:   2%|▏         | 8/424 [00:17<15:06,  0.46it/s, v_num=2, train_loss=1.070]Epoch 0:   2%|▏         | 8/424 [00:17<15:08,  0.46it/s, v_num=2, train_loss=0.678]Epoch 0:   2%|▏         | 9/424 [00:19<15:15,  0.45it/s, v_num=2, train_loss=0.678]Epoch 0:   2%|▏         | 9/424 [00:19<15:15,  0.45it/s, v_num=2, train_loss=0.612]Epoch 0:   2%|▏         | 10/424 [00:31<21:43,  0.32it/s, v_num=2, train_loss=0.612]Epoch 0:   2%|▏         | 10/424 [00:31<21:55,  0.31it/s, v_num=2, train_loss=0.627]Epoch 0:   3%|▎         | 11/424 [00:31<19:58,  0.34it/s, v_num=2, train_loss=0.627]Epoch 0:   3%|▎         | 11/424 [00:31<20:00,  0.34it/s, v_num=2, train_loss=0.699]Epoch 0:   3%|▎         | 12/424 [00:32<18:29,  0.37it/s, v_num=2, train_loss=0.699]Epoch 0:   3%|▎         | 12/424 [00:32<18:39,  0.37it/s, v_num=2, train_loss=0.820]Epoch 0:   3%|▎         | 13/424 [00:32<17:13,  0.40it/s, v_num=2, train_loss=0.820]Epoch 0:   3%|▎         | 13/424 [00:32<17:13,  0.40it/s, v_num=2, train_loss=0.692]Epoch 0:   3%|▎         | 14/424 [00:32<15:59,  0.43it/s, v_num=2, train_loss=0.692]Epoch 0:   3%|▎         | 14/424 [00:32<15:59,  0.43it/s, v_num=2, train_loss=0.254]Epoch 0:   4%|▎         | 15/424 [00:32<14:55,  0.46it/s, v_num=2, train_loss=0.254]Epoch 0:   4%|▎         | 15/424 [00:32<14:56,  0.46it/s, v_num=2, train_loss=0.804]Epoch 0:   4%|▍         | 16/424 [00:41<17:50,  0.38it/s, v_num=2, train_loss=0.804]Epoch 0:   4%|▍         | 16/424 [00:42<17:56,  0.38it/s, v_num=2, train_loss=0.614]Epoch 0:   4%|▍         | 17/424 [00:42<16:54,  0.40it/s, v_num=2, train_loss=0.614]Epoch 0:   4%|▍         | 17/424 [00:42<16:57,  0.40it/s, v_num=2, train_loss=0.615]Epoch 0:   4%|▍         | 18/424 [00:42<15:59,  0.42it/s, v_num=2, train_loss=0.615]Epoch 0:   4%|▍         | 18/424 [00:42<15:59,  0.42it/s, v_num=2, train_loss=0.642]Epoch 0:   4%|▍         | 19/424 [00:42<15:08,  0.45it/s, v_num=2, train_loss=0.642]Epoch 0:   4%|▍         | 19/424 [00:42<15:08,  0.45it/s, v_num=2, train_loss=0.637]Epoch 0:   5%|▍         | 20/424 [00:48<16:18,  0.41it/s, v_num=2, train_loss=0.637]Epoch 0:   5%|▍         | 20/424 [00:48<16:20,  0.41it/s, v_num=2, train_loss=0.558]Epoch 0:   5%|▍         | 21/424 [00:48<15:32,  0.43it/s, v_num=2, train_loss=0.558]Epoch 0:   5%|▍         | 21/424 [00:48<15:33,  0.43it/s, v_num=2, train_loss=0.492]Epoch 0:   5%|▌         | 22/424 [01:03<19:15,  0.35it/s, v_num=2, train_loss=0.492]Epoch 0:   5%|▌         | 22/424 [01:03<19:17,  0.35it/s, v_num=2, train_loss=1.050]Epoch 0:   5%|▌         | 23/424 [01:03<18:26,  0.36it/s, v_num=2, train_loss=1.050]Epoch 0:   5%|▌         | 23/424 [01:03<18:27,  0.36it/s, v_num=2, train_loss=0.479]Epoch 0:   6%|▌         | 24/424 [01:03<17:39,  0.38it/s, v_num=2, train_loss=0.479]Epoch 0:   6%|▌         | 24/424 [01:03<17:40,  0.38it/s, v_num=2, train_loss=0.591]Epoch 0:   6%|▌         | 25/424 [01:03<16:58,  0.39it/s, v_num=2, train_loss=0.591]Epoch 0:   6%|▌         | 25/424 [01:03<17:01,  0.39it/s, v_num=2, train_loss=1.290]Epoch 0:   6%|▌         | 26/424 [01:11<18:08,  0.37it/s, v_num=2, train_loss=1.290]Epoch 0:   6%|▌         | 26/424 [01:11<18:12,  0.36it/s, v_num=2, train_loss=1.380]Epoch 0:   6%|▋         | 27/424 [01:11<17:30,  0.38it/s, v_num=2, train_loss=1.380]Epoch 0:   6%|▋         | 27/424 [01:11<17:30,  0.38it/s, v_num=2, train_loss=0.575]Epoch 0:   7%|▋         | 28/424 [01:11<16:53,  0.39it/s, v_num=2, train_loss=0.575]Epoch 0:   7%|▋         | 28/424 [01:11<16:54,  0.39it/s, v_num=2, train_loss=0.574]Epoch 0:   7%|▋         | 29/424 [01:11<16:18,  0.40it/s, v_num=2, train_loss=0.574]Epoch 0:   7%|▋         | 29/424 [01:11<16:18,  0.40it/s, v_num=2, train_loss=0.549]Epoch 0:   7%|▋         | 30/424 [01:12<15:58,  0.41it/s, v_num=2, train_loss=0.549]Epoch 0:   7%|▋         | 30/424 [01:12<15:58,  0.41it/s, v_num=2, train_loss=0.564]Epoch 0:   7%|▋         | 31/424 [01:14<15:46,  0.42it/s, v_num=2, train_loss=0.564]Epoch 0:   7%|▋         | 31/424 [01:14<15:48,  0.41it/s, v_num=2, train_loss=0.589]Epoch 0:   8%|▊         | 32/424 [01:18<15:57,  0.41it/s, v_num=2, train_loss=0.589]Epoch 0:   8%|▊         | 32/424 [01:18<16:01,  0.41it/s, v_num=2, train_loss=0.570]Epoch 0:   8%|▊         | 33/424 [01:18<15:30,  0.42it/s, v_num=2, train_loss=0.570]Epoch 0:   8%|▊         | 33/424 [01:18<15:30,  0.42it/s, v_num=2, train_loss=0.547]Epoch 0:   8%|▊         | 34/424 [01:18<15:02,  0.43it/s, v_num=2, train_loss=0.547]Epoch 0:   8%|▊         | 34/424 [01:18<15:03,  0.43it/s, v_num=2, train_loss=0.518]Epoch 0:   8%|▊         | 35/424 [01:30<16:49,  0.39it/s, v_num=2, train_loss=0.518]Epoch 0:   8%|▊         | 35/424 [01:31<16:53,  0.38it/s, v_num=2, train_loss=0.544]Epoch 0:   8%|▊         | 36/424 [01:31<16:23,  0.39it/s, v_num=2, train_loss=0.544]Epoch 0:   8%|▊         | 36/424 [01:31<16:23,  0.39it/s, v_num=2, train_loss=0.492]Epoch 0:   9%|▊         | 37/424 [01:31<15:55,  0.41it/s, v_num=2, train_loss=0.492]Epoch 0:   9%|▊         | 37/424 [01:31<15:55,  0.41it/s, v_num=2, train_loss=0.488]Epoch 0:   9%|▉         | 38/424 [01:31<15:28,  0.42it/s, v_num=2, train_loss=0.488]Epoch 0:   9%|▉         | 38/424 [01:31<15:29,  0.42it/s, v_num=2, train_loss=0.390]Epoch 0:   9%|▉         | 39/424 [01:40<16:33,  0.39it/s, v_num=2, train_loss=0.390]Epoch 0:   9%|▉         | 39/424 [01:40<16:35,  0.39it/s, v_num=2, train_loss=0.521]Epoch 0:   9%|▉         | 40/424 [01:41<16:10,  0.40it/s, v_num=2, train_loss=0.521]Epoch 0:   9%|▉         | 40/424 [01:41<16:13,  0.39it/s, v_num=2, train_loss=0.475]Epoch 0:  10%|▉         | 41/424 [01:41<15:50,  0.40it/s, v_num=2, train_loss=0.475]Epoch 0:  10%|▉         | 41/424 [01:42<15:53,  0.40it/s, v_num=2, train_loss=0.745]Epoch 0:  10%|▉         | 42/424 [01:42<15:30,  0.41it/s, v_num=2, train_loss=0.745]Epoch 0:  10%|▉         | 42/424 [01:42<15:32,  0.41it/s, v_num=2, train_loss=0.460]Epoch 0:  10%|█         | 43/424 [01:42<15:10,  0.42it/s, v_num=2, train_loss=0.460]Epoch 0:  10%|█         | 43/424 [01:42<15:10,  0.42it/s, v_num=2, train_loss=0.429]Epoch 0:  10%|█         | 44/424 [01:42<14:47,  0.43it/s, v_num=2, train_loss=0.429]Epoch 0:  10%|█         | 44/424 [01:42<14:47,  0.43it/s, v_num=2, train_loss=0.499]Epoch 0:  11%|█         | 45/424 [01:45<14:45,  0.43it/s, v_num=2, train_loss=0.499]Epoch 0:  11%|█         | 45/424 [01:45<14:48,  0.43it/s, v_num=2, train_loss=0.492]Epoch 0:  11%|█         | 46/424 [01:46<14:39,  0.43it/s, v_num=2, train_loss=0.492]Epoch 0:  11%|█         | 46/424 [01:47<14:41,  0.43it/s, v_num=2, train_loss=0.520]Epoch 0:  11%|█         | 47/424 [01:47<14:21,  0.44it/s, v_num=2, train_loss=0.520]Epoch 0:  11%|█         | 47/424 [01:47<14:21,  0.44it/s, v_num=2, train_loss=0.492]Epoch 0:  11%|█▏        | 48/424 [01:47<14:01,  0.45it/s, v_num=2, train_loss=0.492]Epoch 0:  11%|█▏        | 48/424 [01:47<14:02,  0.45it/s, v_num=2, train_loss=0.458]Epoch 0:  12%|█▏        | 49/424 [02:02<15:37,  0.40it/s, v_num=2, train_loss=0.458]Epoch 0:  12%|█▏        | 49/424 [02:02<15:40,  0.40it/s, v_num=2, train_loss=0.448]Epoch 0:  12%|█▏        | 50/424 [02:03<15:20,  0.41it/s, v_num=2, train_loss=0.448]Epoch 0:  12%|█▏        | 50/424 [02:03<15:21,  0.41it/s, v_num=2, train_loss=0.442]Epoch 0:  12%|█▏        | 51/424 [02:03<15:01,  0.41it/s, v_num=2, train_loss=0.442]Epoch 0:  12%|█▏        | 51/424 [02:03<15:01,  0.41it/s, v_num=2, train_loss=0.124]Epoch 0:  12%|█▏        | 52/424 [02:03<14:43,  0.42it/s, v_num=2, train_loss=0.124]Epoch 0:  12%|█▏        | 52/424 [02:03<14:43,  0.42it/s, v_num=2, train_loss=0.506]Epoch 0:  12%|█▎        | 53/424 [02:04<14:32,  0.43it/s, v_num=2, train_loss=0.506]Epoch 0:  12%|█▎        | 53/424 [02:04<14:32,  0.43it/s, v_num=2, train_loss=0.443]Epoch 0:  13%|█▎        | 54/424 [02:23<16:26,  0.38it/s, v_num=2, train_loss=0.443]Epoch 0:  13%|█▎        | 54/424 [02:25<16:33,  0.37it/s, v_num=2, train_loss=0.995]Epoch 0:  13%|█▎        | 55/424 [02:25<16:14,  0.38it/s, v_num=2, train_loss=0.995]Epoch 0:  13%|█▎        | 55/424 [02:25<16:15,  0.38it/s, v_num=2, train_loss=0.442]Epoch 0:  13%|█▎        | 56/424 [02:25<15:55,  0.39it/s, v_num=2, train_loss=0.442]Epoch 0:  13%|█▎        | 56/424 [02:25<15:55,  0.39it/s, v_num=2, train_loss=0.120]Epoch 0:  13%|█▎        | 57/424 [02:25<15:37,  0.39it/s, v_num=2, train_loss=0.120]Epoch 0:  13%|█▎        | 57/424 [02:25<15:37,  0.39it/s, v_num=2, train_loss=0.375]Epoch 0:  14%|█▎        | 58/424 [02:26<15:23,  0.40it/s, v_num=2, train_loss=0.375]Epoch 0:  14%|█▎        | 58/424 [02:26<15:23,  0.40it/s, v_num=2, train_loss=0.730]Epoch 0:  14%|█▍        | 59/424 [02:26<15:06,  0.40it/s, v_num=2, train_loss=0.730]Epoch 0:  14%|█▍        | 59/424 [02:26<15:06,  0.40it/s, v_num=2, train_loss=0.424]Epoch 0:  14%|█▍        | 60/424 [02:26<14:50,  0.41it/s, v_num=2, train_loss=0.424]Epoch 0:  14%|█▍        | 60/424 [02:27<14:52,  0.41it/s, v_num=2, train_loss=0.397]Epoch 0:  14%|█▍        | 61/424 [02:27<14:36,  0.41it/s, v_num=2, train_loss=0.397]Epoch 0:  14%|█▍        | 61/424 [02:27<14:38,  0.41it/s, v_num=2, train_loss=0.464]Epoch 0:  15%|█▍        | 62/424 [02:36<15:13,  0.40it/s, v_num=2, train_loss=0.464]Epoch 0:  15%|█▍        | 62/424 [02:36<15:15,  0.40it/s, v_num=2, train_loss=1.130]Epoch 0:  15%|█▍        | 63/424 [02:36<14:59,  0.40it/s, v_num=2, train_loss=1.130]Epoch 0:  15%|█▍        | 63/424 [02:37<15:00,  0.40it/s, v_num=2, train_loss=0.413]Epoch 0:  15%|█▌        | 64/424 [02:37<14:43,  0.41it/s, v_num=2, train_loss=0.413]Epoch 0:  15%|█▌        | 64/424 [02:37<14:43,  0.41it/s, v_num=2, train_loss=0.104]Epoch 0:  15%|█▌        | 65/424 [02:42<14:55,  0.40it/s, v_num=2, train_loss=0.104]Epoch 0:  15%|█▌        | 65/424 [02:42<14:57,  0.40it/s, v_num=2, train_loss=0.375]Epoch 0:  16%|█▌        | 66/424 [02:42<14:41,  0.41it/s, v_num=2, train_loss=0.375]Epoch 0:  16%|█▌        | 66/424 [02:42<14:41,  0.41it/s, v_num=2, train_loss=0.100]Epoch 0:  16%|█▌        | 67/424 [02:42<14:26,  0.41it/s, v_num=2, train_loss=0.100]Epoch 0:  16%|█▌        | 67/424 [02:42<14:27,  0.41it/s, v_num=2, train_loss=0.420]Epoch 0:  16%|█▌        | 68/424 [02:43<14:13,  0.42it/s, v_num=2, train_loss=0.420]Epoch 0:  16%|█▌        | 68/424 [02:43<14:15,  0.42it/s, v_num=2, train_loss=0.419]Epoch 0:  16%|█▋        | 69/424 [02:43<14:02,  0.42it/s, v_num=2, train_loss=0.419]Epoch 0:  16%|█▋        | 69/424 [02:43<14:02,  0.42it/s, v_num=2, train_loss=0.391]Epoch 0:  17%|█▋        | 70/424 [02:43<13:48,  0.43it/s, v_num=2, train_loss=0.391]Epoch 0:  17%|█▋        | 70/424 [02:43<13:49,  0.43it/s, v_num=2, train_loss=0.0965]Epoch 0:  17%|█▋        | 71/424 [02:44<13:35,  0.43it/s, v_num=2, train_loss=0.0965]Epoch 0:  17%|█▋        | 71/424 [02:44<13:35,  0.43it/s, v_num=2, train_loss=0.392] Epoch 0:  17%|█▋        | 72/424 [02:50<13:54,  0.42it/s, v_num=2, train_loss=0.392]Epoch 0:  17%|█▋        | 72/424 [02:50<13:54,  0.42it/s, v_num=2, train_loss=0.370]Epoch 0:  17%|█▋        | 73/424 [02:55<14:02,  0.42it/s, v_num=2, train_loss=0.370]Epoch 0:  17%|█▋        | 73/424 [02:55<14:03,  0.42it/s, v_num=2, train_loss=0.351]Epoch 0:  17%|█▋        | 74/424 [02:55<13:50,  0.42it/s, v_num=2, train_loss=0.351]Epoch 0:  17%|█▋        | 74/424 [02:55<13:50,  0.42it/s, v_num=2, train_loss=0.399]Epoch 0:  18%|█▊        | 75/424 [02:55<13:37,  0.43it/s, v_num=2, train_loss=0.399]Epoch 0:  18%|█▊        | 75/424 [02:55<13:37,  0.43it/s, v_num=2, train_loss=0.414]Epoch 0:  18%|█▊        | 76/424 [02:55<13:25,  0.43it/s, v_num=2, train_loss=0.414]Epoch 0:  18%|█▊        | 76/424 [02:55<13:25,  0.43it/s, v_num=2, train_loss=0.422]Epoch 0:  18%|█▊        | 77/424 [03:01<13:38,  0.42it/s, v_num=2, train_loss=0.422]Epoch 0:  18%|█▊        | 77/424 [03:01<13:39,  0.42it/s, v_num=2, train_loss=0.0951]Epoch 0:  18%|█▊        | 78/424 [03:01<13:26,  0.43it/s, v_num=2, train_loss=0.0951]Epoch 0:  18%|█▊        | 78/424 [03:01<13:26,  0.43it/s, v_num=2, train_loss=0.388] Epoch 0:  19%|█▊        | 79/424 [03:01<13:14,  0.43it/s, v_num=2, train_loss=0.388]Epoch 0:  19%|█▊        | 79/424 [03:02<13:15,  0.43it/s, v_num=2, train_loss=0.430]Epoch 0:  19%|█▉        | 80/424 [03:02<13:03,  0.44it/s, v_num=2, train_loss=0.430]Epoch 0:  19%|█▉        | 80/424 [03:02<13:03,  0.44it/s, v_num=2, train_loss=0.382]Epoch 0:  19%|█▉        | 81/424 [03:03<12:58,  0.44it/s, v_num=2, train_loss=0.382]Epoch 0:  19%|█▉        | 81/424 [03:03<12:58,  0.44it/s, v_num=2, train_loss=0.366]Epoch 0:  19%|█▉        | 82/424 [03:04<12:47,  0.45it/s, v_num=2, train_loss=0.366]Epoch 0:  19%|█▉        | 82/424 [03:04<12:47,  0.45it/s, v_num=2, train_loss=0.647]Epoch 0:  20%|█▉        | 83/424 [03:07<12:51,  0.44it/s, v_num=2, train_loss=0.647]Epoch 0:  20%|█▉        | 83/424 [03:08<12:52,  0.44it/s, v_num=2, train_loss=0.343]Epoch 0:  20%|█▉        | 84/424 [03:08<12:41,  0.45it/s, v_num=2, train_loss=0.343]Epoch 0:  20%|█▉        | 84/424 [03:08<12:41,  0.45it/s, v_num=2, train_loss=0.348]Epoch 0:  20%|██        | 85/424 [03:08<12:30,  0.45it/s, v_num=2, train_loss=0.348]Epoch 0:  20%|██        | 85/424 [03:08<12:30,  0.45it/s, v_num=2, train_loss=0.0918]Epoch 0:  20%|██        | 86/424 [03:08<12:20,  0.46it/s, v_num=2, train_loss=0.0918]Epoch 0:  20%|██        | 86/424 [03:08<12:20,  0.46it/s, v_num=2, train_loss=0.379] Epoch 0:  21%|██        | 87/424 [03:11<12:22,  0.45it/s, v_num=2, train_loss=0.379]Epoch 0:  21%|██        | 87/424 [03:11<12:22,  0.45it/s, v_num=2, train_loss=0.335]Epoch 0:  21%|██        | 88/424 [03:11<12:11,  0.46it/s, v_num=2, train_loss=0.335]Epoch 0:  21%|██        | 88/424 [03:11<12:11,  0.46it/s, v_num=2, train_loss=0.390]Epoch 0:  21%|██        | 89/424 [03:11<12:01,  0.46it/s, v_num=2, train_loss=0.390]Epoch 0:  21%|██        | 89/424 [03:11<12:01,  0.46it/s, v_num=2, train_loss=0.383]Epoch 0:  21%|██        | 90/424 [03:11<11:52,  0.47it/s, v_num=2, train_loss=0.383]Epoch 0:  21%|██        | 90/424 [03:11<11:52,  0.47it/s, v_num=2, train_loss=0.327]Epoch 0:  21%|██▏       | 91/424 [03:16<11:57,  0.46it/s, v_num=2, train_loss=0.327]Epoch 0:  21%|██▏       | 91/424 [03:16<11:57,  0.46it/s, v_num=2, train_loss=0.434]Epoch 0:  22%|██▏       | 92/424 [03:16<11:47,  0.47it/s, v_num=2, train_loss=0.434]Epoch 0:  22%|██▏       | 92/424 [03:16<11:47,  0.47it/s, v_num=2, train_loss=0.378]Epoch 0:  22%|██▏       | 93/424 [03:16<11:38,  0.47it/s, v_num=2, train_loss=0.378]Epoch 0:  22%|██▏       | 93/424 [03:16<11:38,  0.47it/s, v_num=2, train_loss=0.365]Epoch 0:  22%|██▏       | 94/424 [03:28<12:13,  0.45it/s, v_num=2, train_loss=0.365]Epoch 0:  22%|██▏       | 94/424 [03:29<12:15,  0.45it/s, v_num=2, train_loss=0.573]Epoch 0:  22%|██▏       | 95/424 [03:29<12:06,  0.45it/s, v_num=2, train_loss=0.573]Epoch 0:  22%|██▏       | 95/424 [03:29<12:06,  0.45it/s, v_num=2, train_loss=0.375]Epoch 0:  23%|██▎       | 96/424 [03:30<11:57,  0.46it/s, v_num=2, train_loss=0.375]Epoch 0:  23%|██▎       | 96/424 [03:30<11:58,  0.46it/s, v_num=2, train_loss=0.321]Epoch 0:  23%|██▎       | 97/424 [03:30<11:49,  0.46it/s, v_num=2, train_loss=0.321]Epoch 0:  23%|██▎       | 97/424 [03:30<11:49,  0.46it/s, v_num=2, train_loss=0.338]Epoch 0:  23%|██▎       | 98/424 [03:45<12:30,  0.43it/s, v_num=2, train_loss=0.338]Epoch 0:  23%|██▎       | 98/424 [03:45<12:31,  0.43it/s, v_num=2, train_loss=0.338]Epoch 0:  23%|██▎       | 99/424 [03:45<12:21,  0.44it/s, v_num=2, train_loss=0.338]Epoch 0:  23%|██▎       | 99/424 [03:45<12:21,  0.44it/s, v_num=2, train_loss=0.363]Epoch 0:  24%|██▎       | 100/424 [03:45<12:12,  0.44it/s, v_num=2, train_loss=0.363]Epoch 0:  24%|██▎       | 100/424 [03:45<12:12,  0.44it/s, v_num=2, train_loss=0.354]Epoch 0:  24%|██▍       | 101/424 [03:46<12:03,  0.45it/s, v_num=2, train_loss=0.354]Epoch 0:  24%|██▍       | 101/424 [03:46<12:03,  0.45it/s, v_num=2, train_loss=0.310]Epoch 0:  24%|██▍       | 102/424 [03:48<11:59,  0.45it/s, v_num=2, train_loss=0.310]Epoch 0:  24%|██▍       | 102/424 [03:48<11:59,  0.45it/s, v_num=2, train_loss=0.408]Epoch 0:  24%|██▍       | 103/424 [03:48<11:51,  0.45it/s, v_num=2, train_loss=0.408]Epoch 0:  24%|██▍       | 103/424 [03:48<11:52,  0.45it/s, v_num=2, train_loss=0.297]Epoch 0:  25%|██▍       | 104/424 [03:48<11:43,  0.45it/s, v_num=2, train_loss=0.297]Epoch 0:  25%|██▍       | 104/424 [03:48<11:44,  0.45it/s, v_num=2, train_loss=0.329]Epoch 0:  25%|██▍       | 105/424 [03:48<11:35,  0.46it/s, v_num=2, train_loss=0.329]Epoch 0:  25%|██▍       | 105/424 [03:48<11:35,  0.46it/s, v_num=2, train_loss=0.381]Epoch 0:  25%|██▌       | 106/424 [03:50<11:32,  0.46it/s, v_num=2, train_loss=0.381]Epoch 0:  25%|██▌       | 106/424 [03:50<11:32,  0.46it/s, v_num=2, train_loss=0.401]Epoch 0:  25%|██▌       | 107/424 [03:51<11:24,  0.46it/s, v_num=2, train_loss=0.401]Epoch 0:  25%|██▌       | 107/424 [03:51<11:25,  0.46it/s, v_num=2, train_loss=0.814]Epoch 0:  25%|██▌       | 108/424 [03:52<11:21,  0.46it/s, v_num=2, train_loss=0.814]Epoch 0:  25%|██▌       | 108/424 [03:52<11:21,  0.46it/s, v_num=2, train_loss=0.313]Epoch 0:  26%|██▌       | 109/424 [03:53<11:13,  0.47it/s, v_num=2, train_loss=0.313]Epoch 0:  26%|██▌       | 109/424 [03:53<11:13,  0.47it/s, v_num=2, train_loss=0.334]Epoch 0:  26%|██▌       | 110/424 [03:53<11:05,  0.47it/s, v_num=2, train_loss=0.334]Epoch 0:  26%|██▌       | 110/424 [03:53<11:05,  0.47it/s, v_num=2, train_loss=0.345]Epoch 0:  26%|██▌       | 111/424 [03:53<10:57,  0.48it/s, v_num=2, train_loss=0.345]Epoch 0:  26%|██▌       | 111/424 [03:53<10:57,  0.48it/s, v_num=2, train_loss=0.101]Epoch 0:  26%|██▋       | 112/424 [04:09<11:33,  0.45it/s, v_num=2, train_loss=0.101]Epoch 0:  26%|██▋       | 112/424 [04:09<11:34,  0.45it/s, v_num=2, train_loss=0.339]
Processing sample TENX68

Processing sample NCBI860

Processing sample MISC14

Processing sample NCBI861

Processing sample SPA139

Processing sample MEND68

Processing sample NCBI591

Processing sample MEND152

Processing sample MISC9

Processing sample NCBI599

Processing sample NCBI518

Processing sample SPA102

Processing sample NCBI575

Processing sample MEND162

Processing sample NCBI691

Processing sample TENX50

Processing sample NCBI2

Processing sample NCBI700

Processing sample MEND65

Processing sample TENX156

Processing sample INT27

Processing sample MEND88

Processing sample MEND91

Processing sample MISC71

Processing sample NCBI535

Processing sample TENX152

Processing sample TENX105

Processing sample SPA33

Processing sample NCBI816

Processing sample SPA60

Processing sample NCBI564

Processing sample NCBI478

Processing sample TENX16

Processing sample NCBI817

Processing sample SPA110

Processing sample TENX121

Processing sample NCBI867

Processing sample NCBI704

Processing sample NCBI1

Processing sample NCBI472

Processing sample MISC20

Processing sample INT35

Processing sample NCBI571

Processing sample TENX125

Processing sample NCBI876

Processing sample TENX118

Processing sample MEND52

Processing sample NCBI821

Processing sample SPA116

Processing sample SPA117

Processing sample NCBI883

Processing sample SPA142

Processing sample INT5

Processing sample TENX111

Processing sample TENX53

Processing sample SPA126

Processing sample MISC28

Processing sample NCBI697

Processing sample SPA57

Processing sample SPA55

Processing sample MISC56

Processing sample NCBI763

Processing sample NCBI785

Processing sample NCBI629

Processing sample TENX144

Processing sample SPA63

Processing sample TENX155

Processing sample MISC39

Processing sample NCBI536

Processing sample TENX24

Processing sample NCBI695

Processing sample INT11

Processing sample NCBI601

Processing sample SPA47

Processing sample MEND62

Processing sample SPA39

Processing sample MISC40

Processing sample MISC64

Processing sample SPA120

Processing sample SPA68

Processing sample MEND19

Processing sample NCBI3

Processing sample SPA109

Processing sample MISC65

Processing sample NCBI696

Processing sample NCBI475

Processing sample INT8

Processing sample MISC72

Processing sample MISC48

Processing sample MISC37

Processing sample MISC128

Processing sample SPA124

Processing sample NCBI520

Processing sample ZEN43

Processing sample MISC18

Processing sample NCBI477

Processing sample TENX106

Processing sample MISC52

Processing sample NCBI694

Processing sample NCBI495

Processing sample TENX148

Processing sample NCBI572

Processing sample TENX27

Processing sample SPA51

Processing sample NCBI483

Processing sample INT17

Processing sample MEND61

Processing sample MISC23

Processing sample MISC41

Processing sample NCBI812

Processing sample SPA64

Processing sample SPA38

Processing sample MISC57

Processing sample MISC27

Processing sample INT10

Processing sample MEND95

Processing sample SPA74

Processing sample MISC42

Processing sample TENX98

Processing sample NCBI636

Processing sample INT3

Processing sample TENX158

Processing sample SPA2

Processing sample MEND147

Processing sample NCBI692

Processing sample SPA70

Processing sample MISC22

Processing sample NCBI563

Processing sample MEND23

Processing sample MEND143
Traceback (most recent call last):
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/train-test-HEST.py", line 304, in <module>
    pred_train, gt_train, R_train, p_val_train = train(
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/train-test-HEST.py", line 105, in train
    trainer.fit(model, train_loader, val_loader)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 543, in fit
    call._call_and_handle_interrupt(
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 44, in _call_and_handle_interrupt
    return trainer_fn(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 579, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 986, in _run
    results = self._run_stage()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/trainer.py", line 1032, in _run_stage
    self.fit_loop.run()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 138, in run
    self.advance(data_fetcher)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 242, in advance
    batch_output = self.automatic_optimization.run(trainer.optimizers[0], batch_idx, kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 191, in run
    self._optimizer_step(batch_idx, closure)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 269, in _optimizer_step
    call._call_lightning_module_hook(
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 157, in _call_lightning_module_hook
    output = fn(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/core/module.py", line 1303, in optimizer_step
    optimizer.step(closure=optimizer_closure)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/core/optimizer.py", line 152, in step
    step_output = self._strategy.optimizer_step(self._optimizer, closure, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/strategies/strategy.py", line 239, in optimizer_step
    return self.precision_plugin.optimizer_step(optimizer, model=model, closure=closure, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/plugins/precision/precision.py", line 122, in optimizer_step
    return optimizer.step(closure=closure, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/optim/optimizer.py", line 493, in wrapper
    out = func(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/optim/optimizer.py", line 91, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/optim/adam.py", line 223, in step
    loss = closure()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/plugins/precision/precision.py", line 108, in _wrap_closure
    closure_result = closure()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 144, in __call__
    self._result = self.closure(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 129, in closure
    step_output = self._step_fn()
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/loops/optimization/automatic.py", line 319, in _training_step
    training_step_output = call._call_strategy_hook(trainer, "training_step", *kwargs.values())
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/trainer/call.py", line 309, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/pytorch_lightning/strategies/strategy.py", line 391, in training_step
    return self.lightning_module.training_step(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/vis_model.py", line 211, in training_step
    pred = self(patch, center, adj)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/vis_model.py", line 202, in forward
    x = self.vit(x)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/transformer.py", line 93, in forward
    x = self.transformer(x)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/transformer.py", line 79, in forward
    x = attn(x) + x
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/transformer.py", line 16, in forward
    return self.fn(self.norm(x), **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/jamie.macdonald2/software/miniforge3/envs/thitogene-env/lib/python3.10/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
  File "/work/bose_lab/Jamie/Summer/models/THItoGene-Fork/transformer.py", line 57, in forward
    dots = einsum('b h i d, b h j d -> b h i j', q, k) * self.scale
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 40.51 GiB. GPU 0 has a total capacity of 79.25 GiB of which 4.24 GiB is free. Including non-PyTorch memory, this process has 75.01 GiB memory in use. Of the allocated memory 74.26 GiB is allocated by PyTorch, and 247.88 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Epoch 0:  26%|██▋       | 112/424 [05:28<15:15,  0.34it/s, v_num=2, train_loss=0.339]